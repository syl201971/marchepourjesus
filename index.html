<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marche Chrétienne pour Jésus - Baie-Comeau 2025</title>
    <meta name="description" content="Unissez-vous pour une marche silencieuse en prière pour Jésus à Baie-Comeau le 15 novembre 2025. De Tadoussac à Havre-Saint-Pierre, rejoignez-nous !">
  <style>
    /* Styles généraux */
    body { 
        font-family: 'Arial', sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #f4f4f4; 
        color: #333; 
        line-height: 1.6; 
        overflow-x: hidden; /* Empêche le défilement horizontal global */
    }
    .container { 
        max-width: 1200px; 
        margin: 0 auto; 
        padding: 20px; 
        width: 100%; /* Assure une largeur fluide */
        box-sizing: border-box; /* Inclut padding dans la largeur */
    }
    header { 
        background: linear-gradient(to right, #8B0000, #DC143C); 
        color: white; 
        text-align: center; 
        padding: 20px; 
    }
    h1 { margin: 0; font-size: 2.5em; }
    .hero { 
        text-align: center; 
        padding: 40px 20px; 
        background: #fff; 
    }
    .hero img { 
        max-width: 100%; 
        height: auto; 
        border-radius: 10px; 
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    }
    .event-details { 
        background: #e9ecef; 
        padding: 20px; 
        border-radius: 10px; 
        margin: 20px 0; 
    }
    .qr-section { 
        text-align: center; 
        margin: 40px 0; 
    }
    .qr-code { 
        width: 200px; 
        height: 200px; 
        background: #ddd; 
        border: 2px dashed #ccc; 
        margin: 0 auto 20px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 0.8em; 
        color: #666; 
    }
    .itinerary { 
        background: #fff; 
        padding: 20px; 
        border-radius: 10px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        width: 100%; 
        box-sizing: border-box; 
    }
    .map { 
        height: 400px; 
        margin: 20px 0; 
        border-radius: 10px; 
        overflow: hidden; 
        width: 100%; 
        max-width: 100%; /* Limite la largeur maximale */
        box-sizing: border-box; /* Inclut bordures/padding */
    }
    footer { 
        background: #333; 
        color: white; 
        text-align: center; 
        padding: 20px; 
    }
    .countdown { 
        font-size: 1.5em; 
        color: #DC143C; 
        font-weight: bold; 
    }
    
    /* Responsive : Mobile */
    @media (max-width: 768px) {
        h1 { font-size: 2em; }
        .hero { padding: 20px 10px; }
        .event-details { padding: 15px; }
        .map { 
            height: 250px; /* Réduit encore pour petits écrans */
            max-width: 100% !important; /* Force la limite */
            overflow-x: hidden; /* Empêche défilement horizontal */
        }
        .itinerary { 
            padding: 10px; 
            overflow-x: hidden; /* Contient l'iframe */
        }
        .qr-code { 
            width: 150px; 
            height: 150px; 
            font-size: 0.7em; 
        }
        .container { 
            padding: 10px; /* Réduit les marges */
        }
    }
    
    /* Desktop */
    @media (min-width: 769px) {
        .container { padding: 40px; }
        h1 { font-size: 3em; }
        .map { height: 450px; } /* Légère augmentation pour desktop */
    }
</style>
<script type="module">
  // Import du SDK Firebase (version modulaire)
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
  import { getFirestore, doc, updateDoc, increment, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';
  import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js';
  import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-messaging.js';

  // Colle ton firebaseConfig ici (de l'étape 3)
  const firebaseConfig = {
    apiKey: "AIzaSyAcxVNsIt4YsrrvhfyQWvZypHym0Cv3z8A",
    authDomain: "marche-pour-jesus.firebaseapp.com",
    projectId: "marche-pour-jesus",
    storageBucket: "marche-pour-jesus.firebasestorage.app",
    messagingSenderId: "915519833949",
    appId: "1:915519833949:web:c3f2cddd593a37bf31cab4",
    measurementId: "G-CWM522GSPR"
  };

  // Initialisation
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const messaging = getMessaging(app); // Initialisation de Messaging

  // Variables globales
  let hasClicked = localStorage.getItem('hasClickedThisSession') || false;
  let unsubscribe; // Pour le listener en temps réel

  // Fonction d'authentification anonyme
  signInAnonymously(auth).catch((error) => console.error('Erreur auth:', error));

  // Écoute en temps réel du compteur
  const counterRef = doc(db, 'counters', 'participants');
  unsubscribe = onSnapshot(counterRef, (docSnap) => {
    if (docSnap.exists()) {
      const count = docSnap.data().count || 0;
      document.getElementById('compteur-participants').innerHTML = count + ' participant' + (count !== 1 ? 's' : '') + ' inscrit' + (count !== 1 ? 's' : '') + ' ! Rejoignez-nous !';

      // Vérifie les milestones pour envoyer une notification (si backend configuré)
      if ([50, 100, 200].includes(count)) {
        // Placeholder : Remplace par un appel backend si tu as une Firebase Function
        console.log(`Milestone atteint : ${count} participants !`);
      }
    }
  });

  // Fonction pour incrémenter
  window.incrementParticipant = function() {
    if (!hasClicked) {
      updateDoc(counterRef, { count: increment(1) })
        .then(async () => {
          const newCount = (await getDoc(counterRef)).data().count;
          localStorage.setItem('hasClickedThisSession', 'true');
          hasClicked = true;
          alert('Merci de votre inscription ! Un seul clic par session est autorisé.');

          // Vérifie milestone et log (backend requis pour push)
          if ([50, 100, 200].includes(newCount)) {
            console.log(`Milestone ${newCount} atteint ! Push non envoyé (backend requis).`);
          }
        })
        .catch((error) => {
          console.error('Erreur incrément:', error);
          alert('Erreur : Réessayez plus tard.');
        });
    } else {
      alert('Vous avez déjà cliqué dans cette session. Rejoignez-nous le 15 novembre !');
    }
  };

  // Réinitialisation à la fermeture
  window.onbeforeunload = function() {
    localStorage.removeItem('hasClickedThisSession');
    if (unsubscribe) unsubscribe();
  };

  // Gestion des notifications push
  async function requestNotificationPermission() {
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      try {
        const token = await getToken(messaging, { vapidKey: 'BHArO-ii_W5psbUcW5QDw9QxBTYQ7aaYvfWpsI7Oe4CmxzNVmsmPoEGPi9q1dWzlQeTVV5jm4MPYuhwdZy59WRE' });
        console.log('Token de notification:', token);
        // Ici, tu devrais envoyer ce token à ton backend pour stocker les abonnés
      } catch (error) {
        console.error('Erreur lors de la récupération du token:', error);
      }
    }
  }

  // Écoute des messages push en temps réel
  onMessage(messaging, (payload) => {
    new Notification(payload.notification.title, { body: payload.notification.body });
  });

  // Demande la permission au chargement de la page
  if ('Notification' in window && Notification.permission === 'default') {
    requestNotificationPermission();
  }
</script>

</head>
<body>
    <header>
        <h1>Marche Chrétienne pour Jésus</h1>
        <p>Baie-Comeau, 15 novembre 2025 - Unissons nos cœurs en prière silencieuse</p>
    </header>

    <div class="container">
        <section class="hero">
           <img src="https://syl201971.github.io/marchepourjesus/images/grok-image-e29b0bc2-18bd-4d72-bced-7589803053d7.png" alt="Jésus avec un regard triomphant, couronne d'épines" width="800" height="600">
            <div class="event-details">
                <h2>Rejoignez-nous pour unir les chrétiens de la Côte-Nord !</h2>
                <p><strong>Date :</strong> 15 novembre 2025</p>
                <p><strong>Heure :</strong> 13h (Durée : ~1-2h)</p>
                <p><strong>Lieu de départ :</strong> Fontaine à Place Lasalle, centre-ville de Baie-Comeau</p>
                <p>De Tadoussac à Havre-Saint-Pierre : Venez marcher en silence, en prière pour Jésus, notre Sauveur. Une marche pour la foi, l'unité et la victoire en Christ !</p>
                <div class="countdown" id="countdown"></div>
            </div>
        </section>
<section class="qr-section">
    <h2>Confirmez votre présence</h2>
    <p>Scannez le QR code sur une affiche ou cliquez ici pour rejoindre la marche !</p>
    <div class="qr-code" onclick="incrementParticipant()" style="cursor: pointer;">
        <img src="https://syl201971.github.io/marchepourjesus/images/qr-marche-jesus.png" alt="QR Code Marche pour Jésus" width="200" height="200">
        <p>(Cliquez ou scannez pour vous inscrire)</p>
    </div>
    <div id="compteur-participants" class="countdown" style="text-align: center; font-size: 1.5em; color: #DC143C;">
        Chargement...
    </div>
</section>
      
<section class="itinerary">
    <h2>Itinéraire de la Marche Silencieuse</h2>
    <ol>
        <li><strong>Départ :</strong> Fontaine à Place Lasalle (centre-ville)</li>
        <li><strong>Direction :</strong> Parc des Pionniers (sentiers le long du fleuve Saint-Laurent)</li>
        <li><strong>Arrivée :</strong> Quai de Baie-Comeau (marina et vue sur le fleuve)</li>
        <li><strong>Retour :</strong> Même itinéraire vers Place Lasalle (prière finale collective)</li>
    </ol>
    <p><strong>Distance totale :</strong> ~3-4 km (facile, accessible à tous). Apportez de l'eau et des chaussures confortables.</p>
    <iframe 
        src="https://www.google.com/maps/embed?pb=!1m43!1m12!1m3!1d4336.385574624234!2d-68.15134768740583!3d49.22136535783645!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m28!3e2!4m4!2s49.22118%2C%20-68.15375!3m2!1d49.22118!2d-68.15375!4m3!3m2!1d49.2199886!2d-68.14402969999999!4m5!1s0x4c9409c7f5dae2c9%3A0x31667b546dd85d5f!2sRestaurant%20Saint%20James%20au%20bar%20de%20l%27eau!3m2!1d49.2303661!2d-68.1326619!4m5!1s0x4c9409b0d4668a45%3A0x85a9b09c81a8c1f2!2sCanada!3m2!1d49.2203124!2d-68.1444072!4m5!1s0x4c9409bbea881757%3A0x143dfef71976f76a!2s69%20Place%20la%20Salle!3m2!1d49.221249799999995!2d-68.1537561!5e1!3m2!1sfr!2sca!4v1758643530644!5m2!1sfr!2sca" 
        width="100%" 
        height="400" 
        style="border:0;" 
        allowfullscreen="" 
        loading="lazy" 
        referrerpolicy="no-referrer-when-downgrade" 
        class="map">
    </iframe>
</section>

        <section class="event-details">
            <h2>Pourquoi cette Marche ?</h2>
            <p>Dans un monde divisé, unissons-nous comme un seul corps en Christ (1 Corinthiens 12:12). Cette marche silencieuse est un acte de foi, de repentance et de célébration de la victoire de Jésus sur la croix. Ouverte à tous les chrétiens : catholiques, évangéliques, etc.</p>
            <p><strong>Contact :</strong> marchepourjesus@baiecomeau.ca | 418-XXX-XXXX</p>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 Marche Chrétienne Baie-Comeau. Gloire à Dieu ! <a href="#" style="color: #ccc;">Partager sur Facebook</a> | <a href="#" style="color: #ccc;">Instagram</a></p>
    </footer>

    <script>
        // Compteur en temps réel jusqu'au 15 nov 2025 à 13h
        function countdown() {
            const eventDate = new Date('2025-11-15T13:00:00').getTime();
            const now = new Date().getTime();
            const distance = eventDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            document.getElementById('countdown').innerHTML = `${days}j ${hours}h ${minutes}min jusqu'à l'événement`;
            if (distance < 0) document.getElementById('countdown').innerHTML = 'L\'événement commence maintenant !';
        }
        setInterval(countdown, 60000); // Mise à jour toutes les minutes
        countdown(); // Appel initial
    </script>
</body>
</html>
